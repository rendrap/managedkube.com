<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.3">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2018-11-16T19:00:05-08:00</updated><id>http://localhost:4000/</id><title type="html">ManagedKube</title><subtitle>Reducing Your Kubernetes Cloud Costs
</subtitle><author><name>Garland Kan</name></author><entry><title type="html">KOPS Updating Cluster Is Awesome</title><link href="http://localhost:4000/kubernetes/kops/gitops/2018/09/20/kops-updating-cluster-is-awesome.html" rel="alternate" type="text/html" title="KOPS Updating Cluster Is Awesome" /><published>2018-09-20T00:00:00-07:00</published><updated>2018-09-20T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/kops/gitops/2018/09/20/kops-updating-cluster-is-awesome</id><content type="html" xml:base="http://localhost:4000/kubernetes/kops/gitops/2018/09/20/kops-updating-cluster-is-awesome.html">&lt;p&gt;Here is yet another reason why I think the &lt;code class=&quot;highlighter-rouge&quot;&gt;Kops&lt;/code&gt; tool for creating and managing a Kubernetes’ cluster
lifecycle is so great.&lt;/p&gt;

&lt;p&gt;I needed to do three things to the cluster:&lt;/p&gt;

&lt;p&gt;1) Set the kubelet timeout to something higher than the default 2 minutes.  This cluster
is in ap-southeast-1 and pulling docker images is really really slow from there.  Some
time it takes longer than 2 minutes and the Kubelet will time out.&lt;/p&gt;

&lt;p&gt;Well luckily &lt;code class=&quot;highlighter-rouge&quot;&gt;kops&lt;/code&gt; exposes all of the Kubelets flags so you can tune it however
you want.  Here is the Kubelet &lt;a href=&quot;https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/&quot;&gt;documentation&lt;/a&gt; showing me
I need to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;--runtime-request-timeout&lt;/code&gt; flag.  This maps to the &lt;code class=&quot;highlighter-rouge&quot;&gt;kops&lt;/code&gt; &lt;a href=&quot;https://github.com/kubernetes/kops/blob/release-1.10/docs/apireference/build/documents/_generated_kubeletconfigspec_v1alpha2_kops_definition.md&quot;&gt;doc&lt;/a&gt; on what this parameter should be in my &lt;code class=&quot;highlighter-rouge&quot;&gt;kops&lt;/code&gt; configs:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;runtimeRequestTimeout: 10m0s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is documentation working to its finest here!  Everything lined up exactly how
I would expect it to.&lt;/p&gt;

&lt;p&gt;2) Change the instance group size on a few instance groups&lt;/p&gt;

&lt;p&gt;3) I needed to add a new &lt;code class=&quot;highlighter-rouge&quot;&gt;kops instance group&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;So i make my changes and run the command to check what &lt;code class=&quot;highlighter-rouge&quot;&gt;kops&lt;/code&gt; would change without
actually applying it to the cluster:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kops --name prod.ap-southeast-1.k8s.managedkube.com update cluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It returns back to me this very handy and life saving diff on what it will exactly
do.&lt;/p&gt;

&lt;p&gt;1) I can see here that it will add these &lt;code class=&quot;highlighter-rouge&quot;&gt;instance groups&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;Will create resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;AutoscalingGroup/ondemand-zone-a-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MinSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MaxSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;5&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Subnets             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[name:worker-zone-a.prod.ap-southeast-1.k8s.managedkube.com id:subnet-58c7a93f]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Tags                &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{Project&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cloud, k8s.io/cluster-autoscaler/node-template/label/k8s.info/hasPublicIP&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, k8s.io/cluster-autoscaler/node-template/label/k8s.info/instanceType&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;m4.large, k8s.io/cluster-autoscaler/node-template/label/k8s.info/application&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;infrastructure, k8s.io/role/node&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1, Name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ondemand-zone-a-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com, k8s.io/cluster-autoscaler/node-template/label/prod.ap-southeast-1.k8s.managedkube.com/role&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;scale-zero, Owner&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes, k8s.io/cluster-autoscaler/node-template/label/k8s.info/isSpot&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, k8s.io/cluster-autoscaler/node-template/label/kops.k8s.io/instancegroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ondemand-zone-a, KubernetesCluster&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prod.ap-southeast-1.k8s.managedkube.com, Purpose&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-ondemand-node, CostCenter&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-saas}&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Granularity         &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1Minute&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Metrics             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[GroupDesiredCapacity, GroupInServiceInstances, GroupMaxSize, GroupMinSize, GroupPendingInstances, GroupStandbyInstances, GroupTerminatingInstances, GroupTotalInstances]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;LaunchConfiguration &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:ondemand-zone-a-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;AutoscalingGroup/ondemand-zone-b-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MinSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MaxSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;5&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Subnets             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[name:worker-zone-b.prod.ap-southeast-1.k8s.managedkube.com id:subnet-9455cbdd]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Tags                &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{CostCenter&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-saas, Owner&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes, k8s.io/cluster-autoscaler/node-template/label/k8s.info/isSpot&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, k8s.io/cluster-autoscaler/node-template/label/k8s.info/application&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;infrastructure, Name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ondemand-zone-b-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com, KubernetesCluster&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prod.ap-southeast-1.k8s.managedkube.com, Project&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cloud, Purpose&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-ondemand-node, k8s.io/cluster-autoscaler/node-template/label/prod.ap-southeast-1.k8s.managedkube.com/role&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;scale-zero, k8s.io/cluster-autoscaler/node-template/label/kops.k8s.io/instancegroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ondemand-zone-b, k8s.io/cluster-autoscaler/node-template/label/k8s.info/hasPublicIP&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, k8s.io/cluster-autoscaler/node-template/label/k8s.info/instanceType&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;m4.large, k8s.io/role/node&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1}&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Granularity         &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1Minute&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Metrics             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[GroupDesiredCapacity, GroupInServiceInstances, GroupMaxSize, GroupMinSize, GroupPendingInstances, GroupStandbyInstances, GroupTerminatingInstances, GroupTotalInstances]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;LaunchConfiguration &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:ondemand-zone-b-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;AutoscalingGroup/ondemand-zone-c-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MinSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MaxSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;5&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Subnets             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[name:worker-zone-c.prod.ap-southeast-1.k8s.managedkube.com id:subnet-53715d15]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Tags                &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{CostCenter&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-saas, k8s.io/cluster-autoscaler/node-template/label/k8s.info/isSpot&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, k8s.io/role/node&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1, Name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ondemand-zone-c-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com, KubernetesCluster&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prod.ap-southeast-1.k8s.managedkube.com, k8s.io/cluster-autoscaler/node-template/label/prod.ap-southeast-1.k8s.managedkube.com/role&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;scale-zero, Owner&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes, Project&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cloud, Purpose&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-ondemand-node, k8s.io/cluster-autoscaler/node-template/label/k8s.info/application&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;infrastructure, k8s.io/cluster-autoscaler/node-template/label/k8s.info/hasPublicIP&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, k8s.io/cluster-autoscaler/node-template/label/k8s.info/instanceType&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;m4.large, k8s.io/cluster-autoscaler/node-template/label/kops.k8s.io/instancegroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ondemand-zone-c}&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Granularity         &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1Minute&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Metrics             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[GroupDesiredCapacity, GroupInServiceInstances, GroupMaxSize, GroupMinSize, GroupPendingInstances, GroupStandbyInstances, GroupTerminatingInstances, GroupTotalInstances]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;LaunchConfiguration &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:ondemand-zone-c-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;LaunchConfiguration/ondemand-zone-a-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ImageID             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;595879546273/CoreOS-stable-1745.7.0-hvm&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;InstanceType        &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m4.large&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SSHKey              &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:managedkube_automation_1 id:managedkube_automation_1&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SecurityGroups      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[name:nodes.prod.ap-southeast-1.k8s.managedkube.com id:sg-c649a7bf]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;AssociatePublicIP   &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;IAMInstanceProfile  &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:nodes.prod.ap-southeast-1.k8s.managedkube.com id:nodes.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;RootVolumeSize      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;128&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;RootVolumeType      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;gp2&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SpotPrice           &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;LaunchConfiguration/ondemand-zone-b-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ImageID             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;595879546273/CoreOS-stable-1745.7.0-hvm&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;InstanceType        &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m4.large&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SSHKey              &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:managedkube_automation_1 id:managedkube_automation_1&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SecurityGroups      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[name:nodes.prod.ap-southeast-1.k8s.managedkube.com id:sg-c649a7bf]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;AssociatePublicIP   &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;IAMInstanceProfile  &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:nodes.prod.ap-southeast-1.k8s.managedkube.com id:nodes.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;RootVolumeSize      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;128&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;RootVolumeType      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;gp2&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SpotPrice           &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;LaunchConfiguration/ondemand-zone-c-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ImageID             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;595879546273/CoreOS-stable-1745.7.0-hvm&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;InstanceType        &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m4.large&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SSHKey              &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:managedkube_automation_1 id:managedkube_automation_1&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SecurityGroups      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[name:nodes.prod.ap-southeast-1.k8s.managedkube.com id:sg-c649a7bf]&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;AssociatePublicIP   &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;IAMInstanceProfile  &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;name:nodes.prod.ap-southeast-1.k8s.managedkube.com id:nodes.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;RootVolumeSize      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;128&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;RootVolumeType      &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;gp2&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;SpotPrice           &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2) It tells me that these instance groups &lt;code class=&quot;highlighter-rouge&quot;&gt;MinSize&lt;/code&gt; will be changed from what value
to the new value:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;Will modify resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;AutoscalingGroup/spot-zone-a-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MinSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; 0 -&amp;gt; 1&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;AutoscalingGroup/spot-zone-b-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MinSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; 0 -&amp;gt; 1&lt;/span&gt;

  &lt;span class=&quot;s&quot;&gt;AutoscalingGroup/spot-zone-c-m4-large-infrastructure.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;MinSize             &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; 0 -&amp;gt; 1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3) Then finally it outputs the &lt;code class=&quot;highlighter-rouge&quot;&gt;runtimeRequestTimeout&lt;/code&gt; flag that I wanted to add and
it enumerates that through to all of the instance groups that it touched.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;s&quot;&gt;LaunchConfiguration/master-ap-southeast-1a.masters.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;UserData&lt;/span&gt;            
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;                    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;                    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;    podInfraContainerImage&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;gcr.io/google_containers/pause-amd64:3.0&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;podManifestPath&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/etc/kubernetes/manifests&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;+   runtimeRequestTimeout&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10m0s&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;  &lt;span class=&quot;na&quot;&gt;masterKubelet&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;  	                    	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;allowPrivileged&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;podManifestPath&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/etc/kubernetes/manifests&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;registerSchedulable&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;+   runtimeRequestTimeout&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10m0s&lt;/span&gt;

  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;__EOF_CLUSTER_SPEC&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;


  &lt;span class=&quot;s&quot;&gt;LaunchConfiguration/master-ap-southeast-1b.masters.prod.ap-southeast-1.k8s.managedkube.com&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;UserData&lt;/span&gt;            
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;podInfraContainerImage&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;gcr.io/google_containers/pause-amd64:3.0&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;podManifestPath&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/etc/kubernetes/manifests&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;+   runtimeRequestTimeout&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10m0s&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;  &lt;span class=&quot;na&quot;&gt;masterKubelet&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;  	                    	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;allowPrivileged&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;podManifestPath&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/etc/kubernetes/manifests&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;    &lt;span class=&quot;na&quot;&gt;registerSchedulable&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;+   runtimeRequestTimeout&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10m0s&lt;/span&gt;

  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;__EOF_CLUSTER_SPEC&lt;/span&gt;
  &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;                    &lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And finally at the end, it tells me if I want to apply these changes add the
&lt;code class=&quot;highlighter-rouge&quot;&gt;--yes&lt;/code&gt; to my command.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;Must specify --yes to apply changes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is absolutely wonderful and this is how I like to apply infrastructure level
changes to my cluster.  Changing any of these without being certain what it will
do exactly can mean major downtime!  I know this is mostly just a diff of some
configs but it is presented out so well that every time I apply this type of changes
it makes me smile =).&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html">Here is yet another reason why I think the Kops tool for creating and managing a Kubernetes’ cluster lifecycle is so great.</summary></entry><entry><title type="html">Kubernetes RBAC Port Forward</title><link href="http://localhost:4000/kubernetes/rbac/port/forward/2018/09/01/kubernetes-rbac-port-forward.html" rel="alternate" type="text/html" title="Kubernetes RBAC Port Forward" /><published>2018-09-01T00:00:00-07:00</published><updated>2018-09-01T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/rbac/port/forward/2018/09/01/kubernetes-rbac-port-forward</id><content type="html" xml:base="http://localhost:4000/kubernetes/rbac/port/forward/2018/09/01/kubernetes-rbac-port-forward.html">&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;kubectl&lt;/code&gt; CLI tool has a really nice feature that lets you port-forward a local
port to a remote port into a pod.  For example, if you are running a Postgres server
or a web server, you usually cant reach it without exposing a &lt;code class=&quot;highlighter-rouge&quot;&gt;nodeport&lt;/code&gt; or an
&lt;code class=&quot;highlighter-rouge&quot;&gt;ingress&lt;/code&gt;.  Sometime this is undesirable because you dont want to expose it out to
the world or you just need to access this port for debugging reasons.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;kubectl port-forward&lt;/code&gt; command allows you to port forward any arbitrary port
from a pod to your local machine.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Local machine (8080)  &amp;lt;---&amp;gt; Kubernetes &amp;lt;--&amp;gt; web (8080)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After setting up the port forward, you can go to your web browser at &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:8080&lt;/code&gt;
and it will send the request to the pod inside of the Kuberentes cluster.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Usage:
  kubectl port-forward POD &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;LOCAL_PORT:]REMOTE_PORT &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...[LOCAL_PORT_N:]REMOTE_PORT_N] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;options]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Listen on port 8888 locally, forwarding to 5000 in the pod&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl port-forward mypod 8888:5000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;rbac&quot;&gt;RBAC&lt;/h2&gt;
&lt;p&gt;To take this example even further, lets say that you want to give a person
access to only port-forward.  You will have to create an RBAC role that lets this
person only do this:&lt;/p&gt;

&lt;p&gt;The role:&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Role&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my-namespace&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;allow-port-forward&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pods&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pods/portforward&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;list&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;create&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This sets up a role in the namespace &lt;code class=&quot;highlighter-rouge&quot;&gt;my-namespace&lt;/code&gt; and allows this role to &lt;code class=&quot;highlighter-rouge&quot;&gt;get&lt;/code&gt;,
&lt;code class=&quot;highlighter-rouge&quot;&gt;list&lt;/code&gt;, and &lt;code class=&quot;highlighter-rouge&quot;&gt;create&lt;/code&gt; on &lt;code class=&quot;highlighter-rouge&quot;&gt;pods&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;pods/portforward&lt;/code&gt;.  These are all of the
permissions needed to allow someone to port-forward.  This person will be able
to list the pods in this namespace.&lt;/p&gt;

&lt;p&gt;Then you bind this role to a user:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;RoleBinding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;allow-port-forward&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my-namespace&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;User&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bob&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Role&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;allow-port-forward&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will give the user &lt;code class=&quot;highlighter-rouge&quot;&gt;bob&lt;/code&gt; the rights to perform the above actions in the namespace &lt;code class=&quot;highlighter-rouge&quot;&gt;my-namespace&lt;/code&gt;&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html">The kubectl CLI tool has a really nice feature that lets you port-forward a local port to a remote port into a pod. For example, if you are running a Postgres server or a web server, you usually cant reach it without exposing a nodeport or an ingress. Sometime this is undesirable because you dont want to expose it out to the world or you just need to access this port for debugging reasons.</summary></entry><entry><title type="html">Kubernetes Cron Jobs</title><link href="http://localhost:4000/kubernetes/cron/job/2018/08/31/kubernetes-running-cronjob.html" rel="alternate" type="text/html" title="Kubernetes Cron Jobs" /><published>2018-08-31T00:00:00-07:00</published><updated>2018-08-31T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/cron/job/2018/08/31/kubernetes-running-cronjob</id><content type="html" xml:base="http://localhost:4000/kubernetes/cron/job/2018/08/31/kubernetes-running-cronjob.html">&lt;p&gt;Sometime you just have to run a cronjob that does something and sometime you have
to run a cronjob that restarts a service.  Yeah, unfortunately this is a thing.&lt;/p&gt;

&lt;p&gt;For example, someone asked me if there is a way we can restart Redis every 24 hours.&lt;/p&gt;

&lt;p&gt;I asked the normal questions, like are there any way we can just fix the problem?
The answer was we are going to use another library that wont need this but that is
coming soon…so that sounds like a reasonable answer.&lt;/p&gt;

&lt;p&gt;Alright…this was my solution.&lt;/p&gt;

&lt;p&gt;I am going to make a Kubernetes cron job that will &lt;code class=&quot;highlighter-rouge&quot;&gt;patch&lt;/code&gt; the &lt;code class=&quot;highlighter-rouge&quot;&gt;deployement&lt;/code&gt; updating
the pod’s label.  The effect this would have is that all of the pods in this deployment
would start to roll per the &lt;code class=&quot;highlighter-rouge&quot;&gt;rolling-update&lt;/code&gt; parameters for this deployment.  Which
works out nicely because the &lt;code class=&quot;highlighter-rouge&quot;&gt;rolling-updates&lt;/code&gt; are safe and there will be no outage
to this service.&lt;/p&gt;

&lt;p&gt;Here are the yaml configurations:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Role&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my-namespace&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis-restart&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;extensions&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;deployments&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;replicasets&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;patch'&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get'&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;RoleBinding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1beta1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis-restart&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my-namespace&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sa-redis-restart&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my-namespace&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Role&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis-restart&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sa-redis-restart&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my-namespace&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;batch/v1beta1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;CronJob&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;restart-redis&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;my-namespace&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*/24&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;jobTemplate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sa-redis-restart&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubectl&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;garland/kubectl:1.10.4&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/bin/sh&lt;/span&gt;
            &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;-c&lt;/span&gt;
            &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubectl patch deployment decision-server -p '{&quot;spec&quot;:{&quot;template&quot;:{&quot;metadata&quot;:{&quot;labels&quot;:{&quot;restarted-by&quot;:&quot;'${POD_NAME}'&quot;}}}}}'&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;POD_NAME&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
                  &lt;span class=&quot;na&quot;&gt;fieldRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;na&quot;&gt;fieldPath&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;metadata.name&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;OnFailure&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Of course you are using RBAC in your Kubernetes cluster…right?&lt;/p&gt;

&lt;p&gt;The first 3 configs are for setting up the permissions: &lt;code class=&quot;highlighter-rouge&quot;&gt;Role&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;RoleBinding&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;ServiceAccount&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;There is a schedule for the cron schedule: &lt;code class=&quot;highlighter-rouge&quot;&gt;schedule: &quot;0 */24 * * *&quot;&lt;/code&gt;.  This is standard
cron syntax.&lt;/p&gt;

&lt;p&gt;It setups a role with permissions only to patch a deployment in the &lt;code class=&quot;highlighter-rouge&quot;&gt;namespace&lt;/code&gt; named: &lt;code class=&quot;highlighter-rouge&quot;&gt;my-namespace&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The fourth yaml config is where the &lt;code class=&quot;highlighter-rouge&quot;&gt;CronJob&lt;/code&gt; is defined.  As you can see it is fairly
simple.&lt;/p&gt;

&lt;p&gt;It uses the &lt;code class=&quot;highlighter-rouge&quot;&gt;serviceAccountName&lt;/code&gt; created above it.&lt;/p&gt;

&lt;p&gt;The image (&lt;code class=&quot;highlighter-rouge&quot;&gt;garland/kubectl:1.10.4&lt;/code&gt;) is a set of images that I maintain to help with
these sort of tasks (https://github.com/sekka1/containers).  It is a small image with
only one binary installed in it to perform distinct tasks (such as this one).&lt;/p&gt;

&lt;p&gt;Since we have to change something in the labels to induce a &lt;code class=&quot;highlighter-rouge&quot;&gt;rolling-update&lt;/code&gt; for the
&lt;code class=&quot;highlighter-rouge&quot;&gt;deployment&lt;/code&gt;, we are updating the label with the pod’s name that is performing this
patch.  These pod names are guaranteeded to be unique.&lt;/p&gt;

&lt;p&gt;There we have it.  A simple cron job with limited permissions to perform a task.&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html">Sometime you just have to run a cronjob that does something and sometime you have to run a cronjob that restarts a service. Yeah, unfortunately this is a thing.</summary></entry><entry><title type="html">Using the AWS CLI - find and terminate an EC2 Instance</title><link href="http://localhost:4000/aws/cli/ec2/2018/08/16/aws-cli-find-and-terminate-instance.html" rel="alternate" type="text/html" title="Using the AWS CLI - find and terminate an EC2 Instance" /><published>2018-08-16T00:00:00-07:00</published><updated>2018-08-16T00:00:00-07:00</updated><id>http://localhost:4000/aws/cli/ec2/2018/08/16/aws-cli-find-and-terminate-instance</id><content type="html" xml:base="http://localhost:4000/aws/cli/ec2/2018/08/16/aws-cli-find-and-terminate-instance.html">&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/blog/images/delete-button.jpg&quot; alt=&quot;Delete&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Sometimes you need to delete an EC2 instance but dont want to go into the AWS
web console.  Most of the time you will have the internal DNS hostname of the instance
which would looks something like: &lt;code class=&quot;highlighter-rouge&quot;&gt;ip-10-151-21-159.ec2.internal&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The AWS CLI doesnt let you terminate a node by a hostname.  It requires the
instance ID.  So the first task is to find the instance ID and then terminate it&lt;/p&gt;

&lt;p&gt;You can find the instance ID by describing an instance and filtering on the &lt;code class=&quot;highlighter-rouge&quot;&gt;private-dns-name&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aws ec2 describe-instances &lt;span class=&quot;nt&quot;&gt;--filters&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Name=private-dns-name,Values=ip-10-151-21-159.ec2.internal&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will give you a big JSON output.  Look for this key: &lt;code class=&quot;highlighter-rouge&quot;&gt;InstanceId&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;If you have &lt;a href=&quot;https://stedolan.github.io/jq/&quot;&gt;jq&lt;/a&gt; installed, you can do this to rip it
right out of the json:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aws ec2 describe-instances &lt;span class=&quot;nt&quot;&gt;--filters&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Name=private-dns-name,Values=ip-10-151-21-159.ec2.internal&quot;&lt;/span&gt; | jq &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; .Reservations[0].Instances[0].InstanceId
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To terminate the instance, you simply run:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aws ec2 terminate-instances &lt;span class=&quot;nt&quot;&gt;--instance-ids&lt;/span&gt; i-07a8839d40f993baa
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Replacing it with your instance ID.&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html"></summary></entry><entry><title type="html">Kubernetes Access External Services</title><link href="http://localhost:4000/kubernetes/service/external/2018/07/19/kubernetes-accessing-external-services.html" rel="alternate" type="text/html" title="Kubernetes Access External Services" /><published>2018-07-19T00:00:00-07:00</published><updated>2018-07-19T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/service/external/2018/07/19/kubernetes-accessing-external-services</id><content type="html" xml:base="http://localhost:4000/kubernetes/service/external/2018/07/19/kubernetes-accessing-external-services.html">&lt;p&gt;There are often time when you will need to access an external service in Kubernetes
but still want to use a static name.&lt;/p&gt;

&lt;p&gt;For example, you have an external database like an AWS RDS (MySQL) hosted by Amazon.
In your application you simply want to refer to this database by the name &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; and
not the fully URL of the name that AWS assigns to it.&lt;/p&gt;

&lt;p&gt;You can add an external service mapping a hostname or by an IP&lt;/p&gt;

&lt;h3 id=&quot;mapping-by-a-hostname-cname&quot;&gt;Mapping by a hostname (CNAME)&lt;/h3&gt;

&lt;p&gt;You want your application to use the hostname &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; which will redirect it to
&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql–instance1.123456789012.us-east-1.rds.amazonaws.com&lt;/code&gt;.  We can have Kubernetes
set this CNAME.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Service&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mysql&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ExternalName&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;externalName&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mysql–instance1.123456789012.us-east-1.rds.amazonaws.com&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, if you go to your pod, you can look up &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; and see that it points to
&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql–instance1.123456789012.us-east-1.rds.amazonaws.com&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dig mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;mapping-a-hostname-to-an-ip&quot;&gt;Mapping a hostname to an IP&lt;/h3&gt;

&lt;p&gt;You want your application to use the hostname &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt; which will redirect to an
IP address.  We can have Kubernetes set this up for us:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Service&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;v1&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mysql&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mysql&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;3306&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;3306&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;nodePort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Endpoints&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;v1&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mysql&quot;&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;addresses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;ip&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;1.1.1.1&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;3306&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mysql&quot;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In your pod, you can check the connectivity.  This will map the hostname &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;
to the IP address &lt;code class=&quot;highlighter-rouge&quot;&gt;1.1.1.1&lt;/code&gt;.&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html">There are often time when you will need to access an external service in Kubernetes but still want to use a static name.</summary></entry><entry><title type="html">sshuttle VPN</title><link href="http://localhost:4000/kubernetes/vpn/2018/07/15/sshuttle.html" rel="alternate" type="text/html" title="sshuttle VPN" /><published>2018-07-15T00:00:00-07:00</published><updated>2018-07-15T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/vpn/2018/07/15/sshuttle</id><content type="html" xml:base="http://localhost:4000/kubernetes/vpn/2018/07/15/sshuttle.html">&lt;p&gt;sshuttle uses ssh and python to create a tunnel from your local machine to any
remote network you are able to ssh into.&lt;/p&gt;

&lt;p&gt;This means that once you sshuttle into a machine, you can access any IP on that
remote network like you were directly connected to it.&lt;/p&gt;

&lt;p&gt;Topology:&lt;/p&gt;

&lt;p&gt;Your laptop (192.168.1.1) &amp;lt;—&amp;gt; Internet &amp;lt;—&amp;gt; (public IP) Remote SSH Host (10.1.1.10)&lt;/p&gt;

&lt;p&gt;This will mean that once you sshuttle in from your local laptop you can ping IP
10.1.1.10 directly from your terminal like you were sitting on that network.&lt;/p&gt;

&lt;h1 id=&quot;project&quot;&gt;Project:&lt;/h1&gt;

&lt;p&gt;https://github.com/apenwarr/sshuttle&lt;/p&gt;

&lt;p&gt;Install guides are there.&lt;/p&gt;

&lt;h1 id=&quot;example-usage&quot;&gt;Example usage:&lt;/h1&gt;

&lt;h2 id=&quot;add-private-key-to-your-env&quot;&gt;Add private key to your env&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh-add &amp;lt;private key to the server&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;to-the-dev-cluster&quot;&gt;to the dev cluster&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sshuttle -r ec2-user@54.85.123.123:22022 10.120.0.0/16 -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Garland Kan</name></author><summary type="html">sshuttle uses ssh and python to create a tunnel from your local machine to any remote network you are able to ssh into.</summary></entry><entry><title type="html">Docker Container Toolbox</title><link href="http://localhost:4000/docker/aws/tools/troubleshooting/2018/07/12/docker-container-toolbox.html" rel="alternate" type="text/html" title="Docker Container Toolbox" /><published>2018-07-12T00:00:00-07:00</published><updated>2018-07-12T00:00:00-07:00</updated><id>http://localhost:4000/docker/aws/tools/troubleshooting/2018/07/12/docker-container-toolbox</id><content type="html" xml:base="http://localhost:4000/docker/aws/tools/troubleshooting/2018/07/12/docker-container-toolbox.html">&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/blog/images/Cover-DockerToolbox.png&quot; alt=&quot;Docker Toolbox&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Docker is useful in many different ways. One way that I use containers is to use them like a toolbox. Mostly the toolbox contains just a binary that I need or a few that are useful together.&lt;/p&gt;

&lt;p&gt;As an example, lot of my work involves using &lt;a href=&quot;https://aws.amazon.com&quot;&gt;Amazon Web Services (AWS)&lt;/a&gt; and I used the &lt;a href=&quot;https://aws.amazon.com/cli/&quot;&gt;aws-cli&lt;/a&gt; to automate things and look up information.&lt;/p&gt;

&lt;p&gt;Most of everything I run nowadays are in containers and most of the systems has &lt;a href=&quot;https://www.docker.com&quot;&gt;Docker&lt;/a&gt; installed. Since I usually dont want to install anything more onto these system(s) but have a need for a tools on the machine, I run a Docker container with the tool I need for my task.&lt;/p&gt;

&lt;p&gt;I have a repository of different tools that are public and in &lt;a href=&quot;https://hub.docker.com&quot;&gt;Docker Hub&lt;/a&gt; that I keep up to date: https://github.com/sekka1/containersp.&lt;/p&gt;

&lt;p&gt;On a machine, if I need to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;aws-cli&lt;/code&gt; I would run this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--env&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;YOUR_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--env&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;YOUR_SECRET_ACCESS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--env&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AWS_DEFAULT_REGION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;us-east-1 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
garland/aws-cli:1.15.47 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
aws ec2 describe-instances &lt;span class=&quot;nt&quot;&gt;--instance-ids&lt;/span&gt; i-90949d7a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since this is a public image, I dont need to log into Docker Hub on that machine to get it and I can use this image from anywhere.&lt;/p&gt;

&lt;p&gt;This is even useful locally when I am testing something out. For example, the &lt;code class=&quot;highlighter-rouge&quot;&gt;aws-cli&lt;/code&gt; has been around for a long time and has many versions. When im updating a script, a lot of the time the systems that are using this script has a certain &lt;code class=&quot;highlighter-rouge&quot;&gt;aws-cli&lt;/code&gt; version. So I would want to test with that version of the &lt;code class=&quot;highlighter-rouge&quot;&gt;aws-cli&lt;/code&gt; locally to make sure everything works out. Instead of installing various versions locally, I just run my tests with the correct versioned container.&lt;/p&gt;

&lt;p&gt;Another use for this container is to upload items to S3 from a server. The server would usually not have &lt;code class=&quot;highlighter-rouge&quot;&gt;aws-cli&lt;/code&gt; installed but it does have Docker. With this command you can upload anything to your S3 buckets:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--env&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;YOUR_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--env&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;YOUR_SECRET_ACCESS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;:/data &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
garland/aws-cli:1.15.47 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
aws s3 sync &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; s3://mybucket
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Garland Kan</name></author><summary type="html"></summary></entry><entry><title type="html">Various kubectl Usage</title><link href="http://localhost:4000/kubernetes/kubectl/logs/2018/07/10/various-kubectl-usage.html" rel="alternate" type="text/html" title="Various kubectl Usage" /><published>2018-07-10T00:00:00-07:00</published><updated>2018-07-10T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/kubectl/logs/2018/07/10/various-kubectl-usage</id><content type="html" xml:base="http://localhost:4000/kubernetes/kubectl/logs/2018/07/10/various-kubectl-usage.html">&lt;p&gt;Download the latest &lt;code class=&quot;highlighter-rouge&quot;&gt;kubectl&lt;/code&gt; version here:  https://kubernetes.io/docs/tasks/tools/install-kubectl/&lt;/p&gt;

&lt;h2 id=&quot;get-a-kube-config-file&quot;&gt;Get a kube config file&lt;/h2&gt;
&lt;p&gt;The kube config file is your authentication with the cluster.  It has information
about the credentials to use and where the Kubernetes cluster is located.&lt;/p&gt;

&lt;p&gt;Ask your local friendly administrator for this.&lt;/p&gt;

&lt;p&gt;Once you have this file, place it in your local path: &lt;code class=&quot;highlighter-rouge&quot;&gt;~/.kube/config&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;test-accessing-the-cluster&quot;&gt;Test accessing the cluster&lt;/h2&gt;

&lt;p&gt;Run this command:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;viewing-pods&quot;&gt;Viewing pods&lt;/h2&gt;
&lt;p&gt;This will list the pods&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Viewing pods in another namespace.  Namespaces are semi isolated areas in the cluster.
We are using one “namespace” for each tenent.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl --namespace devops get pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;getting-logs&quot;&gt;Getting logs&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get logs &amp;lt;pod name from get pods&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;get-a-shell-in-a-container&quot;&gt;Get a shell in a container&lt;/h2&gt;

&lt;p&gt;This will start a bash shell in the container&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl exec -it &amp;lt;pod name from get pods&amp;gt; bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now you can do anything like install a mysql client&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@tomcat-7b9788b887-vfnnm:/usr/local/tomcat# apt-get update &amp;amp;&amp;amp; apt-get install -y mysql-client
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All of our MySQL RDS has a CNAME and inside of these containers it is simply referred to as: &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql&lt;/code&gt;
This will resolve to the local namespace’s RDS instance.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -h mysql -u root -p
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That will connect you in.&lt;/p&gt;

&lt;h2 id=&quot;port-forwarding-from-your-local-to-the-cluster&quot;&gt;Port forwarding from your local to the cluster&lt;/h2&gt;
&lt;p&gt;doc: https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;port-forward &amp;lt;pod name from get pods&amp;gt; 8080:8080
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;kubectl port-forward $(kubectl get pod -o=name -lcomponent=…&lt;/td&gt;
      &lt;td&gt;awk -F/ ‘{print $2}’&lt;/td&gt;
      &lt;td&gt;head -1) PORT&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Being able to port forward to a service is coming: https://github.com/kubernetes/kubernetes/pull/59809&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html">Download the latest kubectl version here: https://kubernetes.io/docs/tasks/tools/install-kubectl/</summary></entry><entry><title type="html">Kops Cluster Templating</title><link href="http://localhost:4000/kubernetes/kops/2018/07/02/kops-templating.html" rel="alternate" type="text/html" title="Kops Cluster Templating" /><published>2018-07-02T00:00:00-07:00</published><updated>2018-07-02T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/kops/2018/07/02/kops-templating</id><content type="html" xml:base="http://localhost:4000/kubernetes/kops/2018/07/02/kops-templating.html">&lt;p&gt;If you havent heard of the tool Kops (https://github.com/kubernetes/kops) for create
Kubernetes clusters, you should check it out right now!  It is a great tool to create
and manage the lifecycle of a Kubernetes cluster.&lt;/p&gt;

&lt;p&gt;If you use Kubernetes for production then you probably have some number of pre production
clusters like &lt;code class=&quot;highlighter-rouge&quot;&gt;dev&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;qa&lt;/code&gt;, or &lt;code class=&quot;highlighter-rouge&quot;&gt;staging&lt;/code&gt;.  Then this leads you to have to create and
maintain these clusters in a sane and easy way.&lt;/p&gt;

&lt;p&gt;The first thing is probably not creating the kops cluster with the kops cli tool input parameters.&lt;br /&gt;
How would you version control this.  This most likely means you want to manage/maintain these clusters with kops cluster
yaml format that describes everything about the cluster (https://github.com/kubernetes/kops/blob/master/docs/apireference/examples/cluster/cluster.yaml).&lt;/p&gt;

&lt;p&gt;But now you have more than one of these yaml files and when you update you have to make sure each one is updated.  This leads you to the cluster templating functionality the kops has to help you out:  https://github.com/kubernetes/kops/blob/master/docs/cluster_template.md&lt;/p&gt;

&lt;p&gt;Now you can have one source &lt;code class=&quot;highlighter-rouge&quot;&gt;cluster.yaml&lt;/code&gt; file which has templated out the names, region, etc and you have a &lt;code class=&quot;highlighter-rouge&quot;&gt;values.yaml&lt;/code&gt; files which values for each cluster you want to make.&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html">If you havent heard of the tool Kops (https://github.com/kubernetes/kops) for create Kubernetes clusters, you should check it out right now! It is a great tool to create and manage the lifecycle of a Kubernetes cluster.</summary></entry><entry><title type="html">Kubernetes RBAC - giving permissions for logging and port-forwarding</title><link href="http://localhost:4000/kubernetes/rbac/security/2018/06/16/kubernetes-rbac.html" rel="alternate" type="text/html" title="Kubernetes RBAC - giving permissions for logging and port-forwarding" /><published>2018-06-16T00:00:00-07:00</published><updated>2018-06-16T00:00:00-07:00</updated><id>http://localhost:4000/kubernetes/rbac/security/2018/06/16/kubernetes-rbac</id><content type="html" xml:base="http://localhost:4000/kubernetes/rbac/security/2018/06/16/kubernetes-rbac.html">&lt;p&gt;I am really liking Kubernetes &lt;a href=&quot;https://kubernetes.io/docs/reference/access-authn-authz/rbac/&quot;&gt;RBAC&lt;/a&gt;. It is “fairly” simple to use and so powerful.&lt;/p&gt;

&lt;p&gt;For example, a user said I can’t port forward to a port and pasted me the error:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;error upgrading connection&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;pods &quot;selenium-node-firefox-debug-mtw7r&quot; is forbidden&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;User &quot;john&quot; cannot create pods/portforward in the namespace &quot;app1&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This basically told me all that I need. It states the user cannot perform the action &lt;code class=&quot;highlighter-rouge&quot;&gt;create&lt;/code&gt; on the resource &lt;code class=&quot;highlighter-rouge&quot;&gt;pods/portforward&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;I do think the “action” (create) and the “resource” (pods/portforward) should be highlighted somehow in the error message to make it even clearer.&lt;/p&gt;

&lt;p&gt;So I added this to his role:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Role&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;spinnaker&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kube-saas:list-and-logs&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pods&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pods/log&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pods/portforward&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;list&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;create&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This solved the problem. I love it when the error tells me exactly what it is and it is so easy to express this in the role.&lt;/p&gt;</content><author><name>Garland Kan</name></author><summary type="html">I am really liking Kubernetes RBAC. It is “fairly” simple to use and so powerful.</summary></entry></feed>